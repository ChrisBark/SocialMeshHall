<html>
<head>
    <title>Social Mesh Hall</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="icon" href="/img/SMH.ico" type="image/x-icon">
</head>
<body>
    <img src="/img/SMH.png" class="logo">
    <div id="live">
        <div id="golive" class="div-button">
            <p>Go Live!</p>
        </div>
        <div id="goliveaudio" class="div-button hidden">
            <p>Go Live (audio only)!</p>
        </div>
        <div id="stop" class="div-button hidden">
            <p>Stop!</p>
        </div>
        <div id="livevideos" class="container">
        </div>
    </div>
    <div id="posts">
    </div>
    <div id="templates">
        <div id="postTemplate">
            <div name="contents" class="container">
            </div>
            <div name="comments" class="comment">
            </div>
        </div>
        <div id="pictureTemplate">
            <img class="image">
        </div>
        <div id="videoTemplate" class="video">
            <video autoplay playsinline muted>
        </div>
        <div id="audioTemplate">
            <audio>
        </div>
        <div id="textTemplate">
            <p></p>
        </div>
        <div id="formTemplate">
            <form name="comment">
                <input type="file" id="files" name="files" multiple />
                <input type="text" name="comment">
                <input type="submit">
            </form>
        </div>
    </div>
    <script src="/config.js"></script>
    <script src="/js/PeerManager.js"></script>
    <script src="/js/FileManager.js"></script>
    <script src="/js/PostManager.js"></script>
    <script src="/js/BroadcastManager.js"></script>
    <script type='application/javascript'>
    document.addEventListener("DOMContentLoaded", () => {
        let postMgr = new PostManager(document.getElementById('livevideos'),
                                      document.getElementById('posts'),
                                      document.getElementById('postTemplate'),
                                      document.getElementById('pictureTemplate'),
                                      document.getElementById('videoTemplate'),
                                      document.getElementById('audioTemplate'),
                                      document.getElementById('textTemplate'),
                                      document.getElementById('formTemplate'));
        let peerMgr = new PeerManager(config.name, config.mainChannel, config.defaultChannel, config.options);
        let fileMgr = new FileManager(peerMgr, postMgr, config);
        let broadcastManager = new BroadcastManager(postMgr,
                                                    peerMgr,
                                                    document.getElementById('golive'),
                                                    document.getElementById('goliveaudio'),
                                                    document.getElementById('stop'),
                                                    config.livePeerConnectionOptions);
        postMgr.start(config, peerMgr, fileMgr, broadcastManager)
        .catch(err => {
            console.log('init error', err);
        });
    });
    </script>
</body>
</html>
